#!/usr/bin/perl

# <!--

use strict;
use warnings;

use CGI;

use Data::Dumper;

use domain::Post;
use repository::PostRepository;
use types::Result;
use types::WithID;

use view::placeholder;

local $Data::Dumper::Terse = 1;

###########################################################3

&placeholder::apply("post", sub {
  my $id = $_[0]->param("id");
  my %maybe_post = &PostRepository::get_by_id($id);

  if(!Result::is_ok(\%maybe_post)) {
    return "Could not find the post";
  }
  my %post_with_id = Result::unwrap(\%maybe_post);

  my $id = WithID::get_id(\%post_with_id);
  my %post = WithID::unwrap(\%post_with_id);

  return <<EOF
<!-- -->
  <article class="article">
    <section>
      <h2 class="article__title">
        ${\(Post::title(\%post))}
      </h2>
      <span class="article__author">
        Posted by ${\(Post::author(\%post))}ãƒ»
        Post number #$id
      </span>
    </section>
    <section>
      ${\(Post::content(\%post))}
    </section>
  </article>
<!--
EOF
;})

# vim: set ft=html: -->
